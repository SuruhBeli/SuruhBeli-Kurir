<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#FB923C">
  <link rel="icon" href="ikon-512.png">
<title>Kurir - Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Nunito',sans-serif;
  margin:0;
  background:#f8f8f8;
  -webkit-tap-highlight-color: transparent;
}
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  user-select:none;
  -webkit-user-select:none;
  outline:none;
}
/* HEADER */
.header{
  display:flex;
  align-items:center;
  justify-content:center;
  background:#FB923C;
  padding:16px;
}

.header img{
  width:100%;
  max-height:150px;
  object-fit:cover;
  border-radius:12px;
}

/* CARD SUMMARY */
#summaryCard{
  position: relative;
  margin: -10px auto 16px auto;
  max-width: 360px;
  background: #fff;
  padding: 12px 16px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  text-align: center;
  font-weight: 700;
  font-size: 16px;
  z-index: 5;
}

/* CONTAINER ORDERS */
.container{
  padding:16px;
  max-width: 400px;
  margin: auto;
}

/* ORDER CARD */
.order-card{
  display:flex;
  align-items:center;
  background:#fff;
  padding:12px;
  margin-bottom:12px;
  border-radius:12px;
  box-shadow:0 4px 10px rgba(0,0,0,0.05);
  gap:12px;
  cursor:pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

.order-card:hover{
  transform: translateY(-3px);
  box-shadow:0 6px 14px rgba(0,0,0,0.15);
}

.order-card img{
  width:50px;
  height:50px;
  border-radius:50%;
  object-fit:cover;
}

.order-info{
  display:flex;
  flex-direction:column;
}

.order-info .judul{
  font-weight:700;
  font-size:16px;
}

.order-info .layanan{
  font-size:14px;
  color:#555;
}

/* Tombol cek lokasi */
.btn-lokasi {
  margin-left:auto;
  padding:6px 12px;
  background:#10B981;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-size:12px;
  font-weight:600;
  transition: background 0.2s, transform 0.2s;
}

.btn-lokasi:hover{
  background:#059669;
  transform: translateY(-2px);
}

/* POPUP OVERLAY */
.popup-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
  padding:16px;
}

.popup-overlay.show{
  display:flex;
}

.popup-card{
  background:#fff;
  border-radius:16px;
  padding:20px;
  max-width:360px;
  width:100%;
  box-shadow:0 10px 30px rgba(0,0,0,0.1);
}

.popup-card h3{
  margin-bottom:12px;
}

.popup-card p{
  margin:6px 0;
}

.btn-close{
  margin-top:12px;
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:#FB923C;
  color:#fff;
  font-weight:700;
  cursor:pointer;
  transition: background 0.2s, transform 0.2s;
}

.btn-close:hover{
  background:#f97316;
  transform: translateY(-2px);
}

/* Loading popup */
#loadingPopup .popup-card{
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  font-size:16px;
  padding:20px;
}

/* ===== EMPTY ANIMASI ===== */
#emptyOrders{
  display:none;
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  z-index:10;
}

.empty-text{
  font-size:18px;
  font-weight:700;
  color:#555;
  display:flex;
  align-items:center;
  gap:8px;
}

/* Lingkaran animasi 3 pulse */
.empty-text span{
  display:block;
  width:10px;
  height:10px;
  background:#FB923C;
  border-radius:50%;
  animation: pulse 1.5s infinite;
}

.empty-text span:nth-child(1){ animation-delay: 0s; }
.empty-text span:nth-child(2){ animation-delay: 0.3s; }
.empty-text span:nth-child(3){ animation-delay: 0.6s; }

@keyframes pulse{
  0% { transform: scale(0); opacity:1; }
  50% { transform: scale(1.5); opacity:0.5; }
  100% { transform: scale(0); opacity:0; }
}
:root{
     --navbar-bg: #FFF7ED;
    --navbar-text: #6B7280;
    --navbar-active-bg: #FB923C;
    --navbar-active-text: #FB923C;
    --navbar-border-radius: 35px;
    --navbar-shadow: 0 8px 20px rgba(0,0,0,0.15);
    --navbar-glass-bg: rgba(255,255,255,0.55);
    --navbar-glass-border: 1px solid rgba(255,255,255,0.35);
    --navbar-glass-blur: blur(14px);
    --nav-circle-shadow: none;
}
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    user-select:none;
    -webkit-user-select:none;
    outline:none;
  }
/* NAVBAR */
.navbar-bottom {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 450px;
  height: 70px;

  background: var(--navbar-bg);
  border-radius: var(--navbar-border-radius);
  box-shadow: var(--navbar-shadow);

  display: flex;
  justify-content: space-around;
  align-items: center;
  z-index: 100;
  transition: all 0.35s ease;
}
/* ===============================
   MODE GEMPA / TRUE GLASSMORPHISM
   =============================== */
.navbar-bottom.gempa-mode{
  background: var(--navbar-glass-bg);
  backdrop-filter: blur(18px) saturate(140%);
  -webkit-backdrop-filter: blur(18px) saturate(140%);
  border: var(--navbar-glass-border);

  /* Shadow glass (lebih premium, tidak berat) */
  box-shadow:
    0 10px 30px rgba(0,0,0,0.25),
    inset 0 1px 0 rgba(255,255,255,0.15);
}

/* Highlight tipis biar efek glass lebih hidup */
.navbar-bottom.gempa-mode::before{
  content: "";
  position: absolute;
  top: 0;
  left: 12%;
  width: 76%;
  height: 1px;
  background: linear-gradient(
    to right,
    transparent,
    rgba(255,255,255,0.35),
    transparent
  );
  pointer-events: none;
}

/* ===============================
   NAV ITEM
   =============================== */
.nav-item {
  position: relative;
  flex: 1;
  text-align: center;
  cursor: pointer;
  color: var(--navbar-text);
  z-index: 2; /* di atas circle */
  transition: transform 0.2s ease;
}

/* Tap effect (mobile friendly hover) */
.nav-item:active{
  transform: scale(0.95);
}

/* ===============================
   ICON SVG
   =============================== */
.nav-item svg {
  width: 28px;
  height: 28px;
  fill: none;
  stroke: var(--navbar-text);
  stroke-width: 1.3;
  transition: 
    transform 0.4s cubic-bezier(.68,-0.55,.27,1.55),
    stroke 0.3s ease;
}

.nav-item.active svg {
  stroke: var(--navbar-active-text);
  transform: translateY(-15px) scale(1.25);
}

/* ===============================
   TEXT LABEL (FIX BUG WARNA)
   =============================== */
.nav-item span {
  display: block;
  margin-top: 1px;
  font-size: 15px;
  font-weight: 700;
  transition: transform 0.3s ease, color 0.3s ease;

  /* ðŸ”¥ FIX: default harus text biasa, bukan aktif */
  color: var(--navbar-text);
}

.nav-item.active span {
  transform: translateY(-5px);
  color: var(--navbar-active-text);
}

/* ===============================
   ACTIVE BACKGROUND CIRCLE (SMOOTH)
   =============================== */
.nav-active-circle {
  position: absolute;
  top: -22px;
  width: 62px;
  height: 62px;

  background: var(--border-soft);
  border-radius: 50%;

  /* pakai variable biar dinamis */
  box-shadow: var(--nav-circle-shadow);

  transition:
    left 0.45s cubic-bezier(.68,-0.55,.27,1.55),
    transform 0.3s ease;

  z-index: 1;
  pointer-events: none;
}
</style>
</head>
<body>

<div class="header">
  <img id="headerFoto" src="default.png" alt="Header">
</div>

<div id="summaryCard">Memuat data...</div>

<div class="container" id="ordersContainer">
  <!-- Orders akan ditampilkan di sini -->
</div>

<!-- Animasi Menunggu Pesanan -->
<div id="emptyOrders">
  <div class="empty-text">
    Menunggu pesanan
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<!-- POPUP DETAIL ORDER -->
<div class="popup-overlay" id="orderPopup">
  <div class="popup-card" id="popupCard">
    <h3 id="popupJudul">Judul Pesanan</h3>
    <p><strong>Pesanan:</strong> <span id="popupPesanan">-</span></p>
    <p><strong>Catatan:</strong> <span id="popupCatatan">-</span></p>
    <p><strong>Beli di:</strong> <span id="popupBeliDi">-</span></p>
    <button class="btn-close" id="btnAmbil">Ambil</button>
  </div>
</div>

<!-- POPUP LOADING & NOTIF -->
<div class="popup-overlay" id="loadingPopup">
  <div class="popup-card">
    <h3 id="loadingText">Sedang memproses...</h3>
  </div>
</div>
<div class="navbar-bottom">
  <div class="nav-active-circle" id="navCircle"></div>

  <div class="nav-item" data-index="0" data-href="index.html">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
      <path d="M11.47 3.841a.75.75 0 0 1 1.06 0l8.69 8.69a.75.75 0 1 0 1.06-1.061l-8.689-8.69a2.25 2.25 0 0 0-3.182 0l-8.69 8.69a.75.75 0 1 0 1.061 1.06l8.69-8.689Z" />
      <path d="m12 5.432 8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 0 1-.75-.75v-4.5a.75.75 0 0 0-.75-.75h-3a.75.75 0 0 0-.75.75V21a.75.75 0 0 1-.75.75H5.625a1.875 1.875 0 0 1-1.875-1.875v-6.198a2.29 2.29 0 0 0 .091-.086L12 5.432Z" />
    </svg>

    <span>Home</span>
  </div>
  <div class="nav-item" data-index="1" data-href="tugas.html">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
      <path fill-rule="evenodd" d="M7.502 6h7.128A3.375 3.375 0 0 1 18 9.375v9.375a3 3 0 0 0 3-3V6.108c0-1.505-1.125-2.811-2.664-2.94a48.972 48.972 0 0 0-.673-.05A3 3 0 0 0 15 1.5h-1.5a3 3 0 0 0-2.663 1.618c-.225.015-.45.032-.673.05C8.662 3.295 7.554 4.542 7.502 6ZM13.5 3A1.5 1.5 0 0 0 12 4.5h4.5A1.5 1.5 0 0 0 15 3h-1.5Z" clip-rule="evenodd" />
      <path fill-rule="evenodd" d="M3 9.375C3 8.339 3.84 7.5 4.875 7.5h9.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V9.375ZM6 12a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V12Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 15a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V15Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 18a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V18Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd" />
    </svg>

    <span>Tugas</span>
  </div>
  <div class="nav-item" data-index="2" data-href="chatlist.html">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
      <path fill-rule="evenodd" d="M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" clip-rule="evenodd" />
    </svg>

    <span>Profil</span>
  </div>
</div>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script>
// ================= FIREBASE CONFIG =================
firebase.initializeApp({
  apiKey: "AIzaSyByQl0BXZoSMzrULUNA6l7UVFQjXmvsdJE",
  authDomain: "suruhbeli-e8ae8.firebaseapp.com",
  projectId: "suruhbeli-e8ae8"
});

const db = firebase.firestore();
const auth = firebase.auth();

let currentUser = null;
let selectedOrderId = null;
let selectedOrderData = null;

// CEK LOGIN
auth.onAuthStateChanged(async user => {
  if(user){
    currentUser = user;

    // cek kurir
    const kurirDoc = await db.collection("kurir").doc(user.uid).get();
    if(!kurirDoc.exists){
      alert("Anda bukan kurir, akses ditolak");
      auth.signOut();
      return;
    }

    loadHeaderFoto();
    loadOrders();
  } else {
    window.location.href = "login.html";
  }
});

// LOAD HEADER FOTO
async function loadHeaderFoto(){
  try{
    const doc = await db.collection("stockfoto").doc("headerhomekurir").get();
    if(doc.exists && doc.data().headerhomekurir){
      document.getElementById("headerFoto").src = doc.data().headerhomekurir;
    }
  } catch(e){ console.error(e); }
}

// LOAD ORDERS
async function loadOrders(){
  const ordersContainer = document.getElementById("ordersContainer");
  const emptyOrders = document.getElementById("emptyOrders");
  ordersContainer.innerHTML = "";

  const summaryCard = document.getElementById("summaryCard");

  const snapshot = await db.collection("orders").where("status","==","Dibuat").get();

  if(snapshot.empty){
    ordersContainer.style.display = "none";
    emptyOrders.style.display = "flex";
    summaryCard.innerText = "Belum ada pesanan masuk";
  } else {
    ordersContainer.style.display = "block";
    emptyOrders.style.display = "none";
    summaryCard.innerText = `Pesanan: ${snapshot.size}`;
  }

  snapshot.forEach(doc=>{
    const data = doc.data();
    const card = document.createElement("div");
    card.classList.add("order-card");

    const img = document.createElement("img");
    img.src = "https://i.pravatar.cc/50?u="+doc.id;

    const info = document.createElement("div");
    info.classList.add("order-info");

    const judul = document.createElement("div");
    judul.classList.add("judul");
    judul.innerText = data.judul||"Pesanan Baru";

    const layanan = document.createElement("div");
    layanan.classList.add("layanan");
    layanan.innerText = data.layanan||"-";

    info.appendChild(judul);
    info.appendChild(layanan);
    card.appendChild(img);
    card.appendChild(info);

    const btnLokasi = document.createElement("button");
    btnLokasi.classList.add("btn-lokasi");
    btnLokasi.innerText = "Cek Lokasi";
    btnLokasi.addEventListener("click", e=>{
      e.stopPropagation();
      if(data.lat && data.lng){
        window.open(`https://www.google.com/maps/search/?api=1&query=${data.lat},${data.lng}`,"_blank");
      } else { showCustomPopup("Lokasi belum tersedia!"); }
    });
    card.appendChild(btnLokasi);

    card.addEventListener("click", ()=>{
      selectedOrderId = doc.id;
      selectedOrderData = data;
      document.getElementById("popupJudul").innerText = data.layanan||"-";
      document.getElementById("popupPesanan").innerText = data.pesanan||"-";
      document.getElementById("popupCatatan").innerText = data.catatan||"-";
      document.getElementById("popupBeliDi").innerText = data.beliDi||"-";
      document.getElementById("orderPopup").classList.add("show");
    });

    ordersContainer.appendChild(card);
  });
}

// POPUP CUSTOM
function showCustomPopup(msg){
  const loading = document.getElementById("loadingPopup");
  const loadingText = document.getElementById("loadingText");
  loadingText.innerText = msg;
  loading.classList.add("show");
  setTimeout(()=> loading.classList.remove("show"),1500);
}

// CLOSE POPUP
function closePopup(){
  document.getElementById("orderPopup").classList.remove("show");
}
document.getElementById("orderPopup").addEventListener("click", e=>{
  if(e.target.id==="orderPopup") closePopup();
});

// TOMBOL AMBIL
document.getElementById("btnAmbil").addEventListener("click", async ()=>{
  if(!selectedOrderId||!currentUser) return;
  const loading=document.getElementById("loadingPopup");
  const loadingText=document.getElementById("loadingText");
  loadingText.innerText="Sedang memproses...";
  loading.classList.add("show");

  try{
    const kurirDoc=await db.collection("kurir").doc(currentUser.uid).get();
    const noKurir=kurirDoc.exists?kurirDoc.data().noHP:"";
    await db.collection("orders").doc(selectedOrderId).update({
      status:"Diproses",
      kurir: currentUser.uid,
      noKurir:noKurir
    });
    loadingText.innerText="Pesanan berhasil diambil!";
    setTimeout(()=>{
      loading.classList.remove("show");
      closePopup();
      window.location.href="tugas.html";
    },1000);
  } catch(e){
    console.error(e);
    loadingText.innerText="Gagal mengambil pesanan!";
    setTimeout(()=>loading.classList.remove("show"),2000);
  }
});
/* === NAVBAR BAWAH === */
const navItems = document.querySelectorAll('.nav-item');
const navCircle = document.getElementById('navCircle');
document.querySelector('.navbar-bottom')
  .classList.toggle('gempa-mode');
  
function updateNavCircle(activeIndex) {
  const activeItem = navItems[activeIndex];
  if (!activeItem || !navCircle) return;

  // Hitung posisi center ikon relatif ke navbar
  const navbarRect = activeItem.parentElement.getBoundingClientRect();
  const icon = activeItem.querySelector('svg');
  const iconRect = icon.getBoundingClientRect();

  const centerX = iconRect.left + iconRect.width / 2 - navbarRect.left;

  navCircle.style.left = `${centerX - navCircle.offsetWidth / 2}px`;
  navCircle.style.transform = 'scale(1.15)';

  setTimeout(() => {
    navCircle.style.transform = 'scale(1)';
  }, 200);
}

// Inisialisasi tab aktif sesuai URL
let currentPage = window.location.pathname.split("/").pop() || 'index.html';
navItems.forEach((item, idx) => {
  if (item.dataset.href === currentPage) {
    item.classList.add('active');
    updateNavCircle(idx);
  }

  // Event klik
  item.addEventListener('click', (e) => {
    e.preventDefault();
    navItems.forEach(i => i.classList.remove('active'));
    item.classList.add('active');
    updateNavCircle(idx);

    setTimeout(() => {
      window.location.href = item.dataset.href;
    }, 250); // animasi bulatan selesai dulu
  });
});

// Update posisi saat resize / load
function updateActiveCircle() {
  const active = document.querySelector('.nav-item.active');
  if (active) {
    const idx = Array.from(navItems).indexOf(active);
    updateNavCircle(idx);
  }
}

window.addEventListener('resize', updateActiveCircle);
window.addEventListener('load', updateActiveCircle);
// SW INSTALL
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/sw.js")
      .then(() => console.log("SW registered"))
      .catch(err => console.log("SW error:", err));
  });
}
</script>
</body>
</html>